#define VSCSI_NTYPES 20
#if VSCSI_STRICT
static unsigned char scsi_commands[VSCSI_NTYPES][32] = {
	{ /* 00 - Disk */
		0x19, 0x01, 0x04, 0x20, 0x20, 0x01, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 01 - Tape */
		0x2B, 0x00, 0x27, 0x26, 0x00, 0x00, 0x10, 0x00, 
		0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x01, 0x05, 0x08, 0x00, 0x01, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 02 - Printer */
		0x09, 0x04, 0xC4, 0x20, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 03 - Processor */
		0x09, 0x04, 0x04, 0x20, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 04 - WORM */
		0x09, 0x00, 0x04, 0x20, 0x20, 0x05, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 05 - CD/DVD */
		0x09, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x40, 0x04, 0x20, 0x04, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 06 - Scanner */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 07 - Optical */
		0x09, 0x00, 0x04, 0x20, 0x20, 0x05, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 08 - Changer */
		0x09, 0x00, 0x04, 0x20, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x01, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 09 - Communication */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 10 - Obsolete */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 11 - Obsolete */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 12 - Raid */
		0x09, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x54, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 13 - Enclosure */
		0x09, 0x00, 0x04, 0x30, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 14 - Simple Disk */
		0x01, 0x00, 0x04, 0x08, 0x20, 0x45, 0x20, 0x08, 
		0x00, 0x00, 0x20, 0x04, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 15 - Card Reader */
		0x09, 0x00, 0x04, 0x20, 0x20, 0x01, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 16 - Bridge */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 17 - OSD */
		0x09, 0x00, 0x04, 0x20, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x80, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 18 - Automation */
		0x09, 0x00, 0x04, 0x28, 0x00, 0x00, 0x00, 0x00, 
		0x10, 0x20, 0x20, 0x04, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x10, 0x00, 0x80, 0x09, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
	{ /* 19 - Security */
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	},
};
#endif

typedef int (*vscsi_opfunc_t)(struct vscsi_device *, struct scsi_cmnd *);

#define VSCSI_MAX_OP 0xbe
struct vscsi_op {
	char *name;
	vscsi_opfunc_t func;
} vscsi_ops[VSCSI_MAX_OP+1] = {
	{ "test_unit_ready",test_unit_ready },						/* 00 */
	{ "rewind",rewind },							/* 01 */
	{ 0,0 },								/* 02 */
	{ "request_sense",request_sense },						/* 03 */
	{ "format_unit",format_unit },						/* 04 */
	{ "read_block_limits",read_block_limits },						/* 05 */
	{ 0,0 },								/* 06 */
	{ 0,0 },								/* 07 */
	{ "read_6",read_6 },							/* 08 */
	{ 0,0 },								/* 09 */
	{ "send_6",send_6 },							/* 0a */
	{ 0,0 },								/* 0b */
	{ 0,0 },								/* 0c */
	{ 0,0 },								/* 0d */
	{ 0,0 },								/* 0e */
	{ 0,0 },								/* 0f */
	{ "write_filemarks_6",write_filemarks_6 },						/* 10 */
	{ "space_6",space_6 },							/* 11 */
	{ "inquiry",inquiry },							/* 12 */
	{ 0,0 },								/* 13 */
	{ 0,0 },								/* 14 */
	{ "mode_select_6",mode_select_6 },						/* 15 */
	{ "reserve_6",reserve_6 },							/* 16 */
	{ "release_6",release_6 },							/* 17 */
	{ 0,0 },								/* 18 */
	{ "erase_6",erase_6 },							/* 19 */
	{ "mode_sense_6",mode_sense_6 },						/* 1a */
	{ "start_stop_unit",start_stop_unit },						/* 1b */
	{ "receive_diagnostic_results",receive_diagnostic_results },					/* 1c */
	{ "send_diagnostic",send_diagnostic },						/* 1d */
	{ 0,0 },								/* 1e */
	{ 0,0 },								/* 1f */
	{ 0,0 },								/* 20 */
	{ 0,0 },								/* 21 */
	{ 0,0 },								/* 22 */
	{ 0,0 },								/* 23 */
	{ 0,0 },								/* 24 */
	{ "read_capacity_10",read_capacity_10 },						/* 25 */
	{ 0,0 },								/* 26 */
	{ 0,0 },								/* 27 */
	{ "read_10",read_10 },							/* 28 */
	{ 0,0 },								/* 29 */
	{ "write_10",write_10 },							/* 2a */
	{ 0,0 },								/* 2b */
	{ 0,0 },								/* 2c */
	{ 0,0 },								/* 2d */
	{ "write_and_verify_10",write_and_verify_10 },					/* 2e */
	{ 0,0 },								/* 2f */
	{ 0,0 },								/* 30 */
	{ 0,0 },								/* 31 */
	{ 0,0 },								/* 32 */
	{ 0,0 },								/* 33 */
	{ "read_position",read_position },						/* 34 */
	{ "synchronize_cache_10",synchronize_cache_10 },					/* 35 */
	{ 0,0 },								/* 36 */
	{ 0,0 },								/* 37 */
	{ 0,0 },								/* 38 */
	{ 0,0 },								/* 39 */
	{ 0,0 },								/* 3a */
	{ "write_buffer",write_buffer },						/* 3b */
	{ 0,0 },								/* 3c */
	{ 0,0 },								/* 3d */
	{ 0,0 },								/* 3e */
	{ 0,0 },								/* 3f */
	{ 0,0 },								/* 40 */
	{ 0,0 },								/* 41 */
	{ 0,0 },								/* 42 */
	{ 0,0 },								/* 43 */
	{ "report_density_support",report_density_support },					/* 44 */
	{ 0,0 },								/* 45 */
	{ "get_configuration",get_configuration },						/* 46 */
	{ 0,0 },								/* 47 */
	{ 0,0 },								/* 48 */
	{ 0,0 },								/* 49 */
	{ "get_event_status_notification",get_event_status_notification },				/* 4a */
	{ 0,0 },								/* 4b */
	{ 0,0 },								/* 4c */
	{ "log_sense",log_sense },							/* 4d */
	{ 0,0 },								/* 4e */
	{ 0,0 },								/* 4f */
	{ 0,0 },								/* 50 */
	{ 0,0 },								/* 51 */
	{ 0,0 },								/* 52 */
	{ 0,0 },								/* 53 */
	{ 0,0 },								/* 54 */
	{ "mode_select_10",mode_select_10 },						/* 55 */
	{ "reserve_10",reserve_10 },							/* 56 */
	{ "release_10",release_10 },							/* 57 */
	{ 0,0 },								/* 58 */
	{ 0,0 },								/* 59 */
	{ "mode_sense_10",mode_sense_10 },						/* 5a */
	{ 0,0 },								/* 5b */
	{ 0,0 },								/* 5c */
	{ 0,0 },								/* 5d */
	{ "persistent_reserve_in",persistent_reserve_in },					/* 5e */
	{ "persistent_reserve_out",persistent_reserve_out },					/* 5f */
	{ 0,0 },								/* 60 */
	{ 0,0 },								/* 61 */
	{ 0,0 },								/* 62 */
	{ 0,0 },								/* 63 */
	{ 0,0 },								/* 64 */
	{ 0,0 },								/* 65 */
	{ 0,0 },								/* 66 */
	{ 0,0 },								/* 67 */
	{ 0,0 },								/* 68 */
	{ 0,0 },								/* 69 */
	{ 0,0 },								/* 6a */
	{ 0,0 },								/* 6b */
	{ 0,0 },								/* 6c */
	{ 0,0 },								/* 6d */
	{ 0,0 },								/* 6e */
	{ 0,0 },								/* 6f */
	{ 0,0 },								/* 70 */
	{ 0,0 },								/* 71 */
	{ 0,0 },								/* 72 */
	{ 0,0 },								/* 73 */
	{ 0,0 },								/* 74 */
	{ 0,0 },								/* 75 */
	{ 0,0 },								/* 76 */
	{ 0,0 },								/* 77 */
	{ 0,0 },								/* 78 */
	{ 0,0 },								/* 79 */
	{ 0,0 },								/* 7a */
	{ 0,0 },								/* 7b */
	{ 0,0 },								/* 7c */
	{ 0,0 },								/* 7d */
	{ 0,0 },								/* 7e */
	{ "variable_length_cdb",variable_length_cdb },					/* 7f */
	{ "write_filemarks_16",write_filemarks_16 },						/* 80 */
	{ 0,0 },								/* 81 */
	{ 0,0 },								/* 82 */
	{ 0,0 },								/* 83 */
	{ 0,0 },								/* 84 */
	{ 0,0 },								/* 85 */
	{ 0,0 },								/* 86 */
	{ 0,0 },								/* 87 */
	{ "read_16",read_16 },							/* 88 */
	{ 0,0 },								/* 89 */
	{ "write_16",write_16 },							/* 8a */
	{ 0,0 },								/* 8b */
	{ "read_attribute",read_attribute },						/* 8c */
	{ 0,0 },								/* 8d */
	{ 0,0 },								/* 8e */
	{ 0,0 },								/* 8f */
	{ 0,0 },								/* 90 */
	{ 0,0 },								/* 91 */
	{ 0,0 },								/* 92 */
	{ "erase_16",erase_16 },							/* 93 */
	{ 0,0 },								/* 94 */
	{ 0,0 },								/* 95 */
	{ 0,0 },								/* 96 */
	{ 0,0 },								/* 97 */
	{ 0,0 },								/* 98 */
	{ 0,0 },								/* 99 */
	{ 0,0 },								/* 9a */
	{ 0,0 },								/* 9b */
	{ 0,0 },								/* 9c */
	{ 0,0 },								/* 9d */
	{ 0,0 },								/* 9e */
	{ "service_action_out_16",service_action_out_16 },					/* 9f */
	{ "report_luns",report_luns },						/* a0 */
	{ 0,0 },								/* a1 */
	{ 0,0 },								/* a2 */
	{ "maintenance_in",maintenance_in },						/* a3 */
	{ 0,0 },								/* a4 */
	{ "move_medium",move_medium },						/* a5 */
	{ 0,0 },								/* a6 */
	{ 0,0 },								/* a7 */
	{ 0,0 },								/* a8 */
	{ 0,0 },								/* a9 */
	{ 0,0 },								/* aa */
	{ 0,0 },								/* ab */
	{ 0,0 },								/* ac */
	{ 0,0 },								/* ad */
	{ 0,0 },								/* ae */
	{ 0,0 },								/* af */
	{ 0,0 },								/* b0 */
	{ 0,0 },								/* b1 */
	{ 0,0 },								/* b2 */
	{ 0,0 },								/* b3 */
	{ 0,0 },								/* b4 */
	{ 0,0 },								/* b5 */
	{ 0,0 },								/* b6 */
	{ 0,0 },								/* b7 */
	{ "read_element_status",read_element_status },					/* b8 */
	{ 0,0 },								/* b9 */
	{ "redundancy_group_in",redundancy_group_in },					/* ba */
	{ 0,0 },								/* bb */
	{ "spare_in",spare_in },							/* bc */
	{ 0,0 },								/* bd */
	{ "volume_set_in",volume_set_in },						/* be */
};
